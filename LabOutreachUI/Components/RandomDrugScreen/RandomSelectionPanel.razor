@* Random Selection Panel Component *@
@if (!string.IsNullOrEmpty(SelectedClient))
{
    <div class="row mb-3">
        <div class="col-md-12">
            <div class="card border-primary">
                <div class="card-header bg-primary text-white" style="cursor: pointer;" @onclick="TogglePanel">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <span class="oi oi-random"></span> Random Selection
                        </h5>
                        <span class="oi @(IsExpanded ? "oi-chevron-top" : "oi-chevron-bottom")"></span>
                    </div>
                </div>

                @if (IsExpanded)
                {
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="selectionShift" class="form-label">Shift Filter (Optional)</label>
                                        <select id="selectionShift"
                                                class="form-select"
                                                value="@SelectionShift"
                                                @onchange="HandleShiftChanged">
                                            <option value="">-- All Shifts --</option>
                                            @foreach (var shift in Shifts)
                                            {
                                                <option value="@shift">@shift</option>
                                            }
                                        </select>
                                    </div>

                                    <div class="col-md-6">
                                        <label for="selectionCount" class="form-label">Number to Select *</label>
                                        <input type="number"
                                               id="selectionCount"
                                               class="form-control"
                                               value="@SelectionCount"
                                               @onchange="HandleSelectionCountChanged"
                                               min="1"
                                               max="@AvailableCount" />
                                        <small class="text-muted">Available: @AvailableCount</small>
                                    </div>
                                </div>

                                @if (!string.IsNullOrEmpty(ValidationMessage))
                                {
                                    <div class="alert alert-warning">
                                        <span class="oi oi-warning"></span> @ValidationMessage
                                    </div>
                                }

                                @if (!string.IsNullOrEmpty(ErrorMessage))
                                {
                                    <div class="alert alert-danger">
                                        <span class="oi oi-x"></span> @ErrorMessage
                                    </div>
                                }

                                <div class="d-grid gap-2">
                                    <button class="btn btn-primary btn-lg"
                                            @onclick="HandlePerformSelection"
                                            disabled="@(IsProcessing || !CanPerformSelection)">
                                        @if (IsProcessing)
                                        {
                                            <span class="spinner-border spinner-border-sm" role="status"></span>
                                            <text> Generating Selection...</text>
                                        }
                                        else
                                        {
                                            <span class="oi oi-random"></span>
                                            <text> Generate Random Selection</text>
                                        }
                                    </button>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="card-title">Selection Info</h6>
                                        <dl class="mb-0">
                                            <dt>Client</dt>
                                            <dd>@SelectedClient</dd>
                                            <dt>Shift Filter</dt>
                                            <dd>@(string.IsNullOrEmpty(SelectionShift) ? "All shifts" : SelectionShift)</dd>
                                            <dt>Selection Count</dt>
                                            <dd>@SelectionCount</dd>
                                            <dt>Available</dt>
                                            <dd>@AvailableCount</dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
}

@code {
    [Parameter] public string SelectedClient { get; set; } = string.Empty;
    [Parameter] public List<string> Shifts { get; set; } = new();
    [Parameter] public bool IsExpanded { get; set; }
    [Parameter] public string SelectionShift { get; set; } = string.Empty;
    [Parameter] public int SelectionCount { get; set; } = 1;
    [Parameter] public int AvailableCount { get; set; }
    [Parameter] public bool IsProcessing { get; set; }
    [Parameter] public bool CanPerformSelection { get; set; }
    [Parameter] public string? ValidationMessage { get; set; }
    [Parameter] public string? ErrorMessage { get; set; }
    [Parameter] public EventCallback OnTogglePanel { get; set; }
    [Parameter] public EventCallback<string> OnShiftChanged { get; set; }
    [Parameter] public EventCallback<int> OnSelectionCountChanged { get; set; }
    [Parameter] public EventCallback OnPerformSelection { get; set; }

    private async Task TogglePanel()
    {
        await OnTogglePanel.InvokeAsync();
    }

    private async Task HandleShiftChanged(ChangeEventArgs e)
    {
        var newShift = e.Value?.ToString() ?? string.Empty;
        await OnShiftChanged.InvokeAsync(newShift);
    }

    private async Task HandleSelectionCountChanged(ChangeEventArgs e)
    {
        if (int.TryParse(e.Value?.ToString(), out int newCount))
        {
            await OnSelectionCountChanged.InvokeAsync(newCount);
        }
    }

    private async Task HandlePerformSelection()
    {
        await OnPerformSelection.InvokeAsync();
    }
}
